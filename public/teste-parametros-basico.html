<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste B√°sico - Par√¢metros URL</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 5px; 
            border-left: 4px solid #007bff;
        }
        .success { background: #d4edda; border-left-color: #28a745; }
        .error { background: #f8d7da; border-left-color: #dc3545; }
        .warning { background: #fff3cd; border-left-color: #ffc107; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste B√°sico - Detec√ß√£o de Par√¢metros</h1>
        
        <button onclick="window.location.href='?error=access_denied&error_code=otp_expired&error_description=Email+link+is+invalid+or+has+expired'">
            üìß Simular Link Expirado
        </button>
        
        <button onclick="window.location.href='?token=custom-token-utnzwk93y&type=signup'">
            üéØ Simular Token Customizado
        </button>
        
        <button onclick="window.location.href='?'">
            üßπ Limpar Par√¢metros
        </button>

        <div id="resultados"></div>
    </div>

    <script>
        function addResult(message, type = 'result') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            document.getElementById('resultados').appendChild(div);
        }

        function analisarURL() {
            // Limpar resultados anteriores
            document.getElementById('resultados').innerHTML = '';
            
            addResult(`<strong>üîç An√°lise da URL Atual</strong>`, 'result');
            addResult(`<strong>URL:</strong> ${window.location.href}`, 'result');
            addResult(`<strong>Search:</strong> ${window.location.search}`, 'result');
            
            if (!window.location.search) {
                addResult(`‚ùå <strong>Nenhum par√¢metro encontrado</strong>`, 'error');
                return;
            }

            const params = new URLSearchParams(window.location.search);
            
            addResult(`‚úÖ <strong>Par√¢metros encontrados (${params.size}):</strong>`, 'success');
            
            params.forEach((value, key) => {
                addResult(`‚Ä¢ <code>${key}</code>: <code>${value}</code>`, 'result');
            });

            // Testar detec√ß√£o de erro
            const error = params.get("error");
            const errorCode = params.get("error_code");
            const errorDescription = params.get("error_description");

            if (error) {
                addResult(`üö® <strong>ERRO DETECTADO!</strong>`, 'warning');
                addResult(`‚Ä¢ Error: <code>${error}</code>`, 'warning');
                addResult(`‚Ä¢ Error Code: <code>${errorCode}</code>`, 'warning');
                addResult(`‚Ä¢ Error Description: <code>${decodeURIComponent(errorDescription || '')}</code>`, 'warning');

                // Testar a l√≥gica condicional exata
                if (error === "access_denied" && errorCode === "otp_expired") {
                    addResult(`üéØ <strong>CONDI√á√ÉO ESPEC√çFICA ATENDIDA!</strong>`, 'success');
                    addResult(`‚úÖ error === "access_denied" && errorCode === "otp_expired"`, 'success');
                    addResult(`üìù <strong>Mensagem esperada:</strong> "O link de confirma√ß√£o expirou ou √© inv√°lido. Links de confirma√ß√£o s√£o v√°lidos por apenas 24 horas."`, 'success');
                } else {
                    addResult(`‚ùå Condi√ß√£o espec√≠fica N√ÉO atendida`, 'error');
                    addResult(`‚Ä¢ error === "access_denied": ${error === "access_denied"}`, 'error');
                    addResult(`‚Ä¢ errorCode === "otp_expired": ${errorCode === "otp_expired"}`, 'error');
                }

                // Testar segunda condi√ß√£o
                if (errorDescription && (errorDescription.includes("invalid") || errorDescription.includes("expired"))) {
                    addResult(`üéØ <strong>SEGUNDA CONDI√á√ÉO TAMB√âM ATENDIDA!</strong>`, 'success');
                    addResult(`‚úÖ errorDescription cont√©m "invalid" ou "expired"`, 'success');
                } else {
                    addResult(`‚ùå Segunda condi√ß√£o N√ÉO atendida`, 'error');
                }
            } else {
                addResult(`‚ÑπÔ∏è Nenhum par√¢metro de erro detectado`, 'result');
            }

            // Testar detec√ß√£o de token
            const token = params.get("token");
            const tokenHash = params.get("token_hash");

            if (token) {
                addResult(`üéØ <strong>TOKEN DETECTADO!</strong>`, 'success');
                addResult(`‚Ä¢ Token: <code>${token}</code>`, 'success');
                
                if (token.startsWith('custom-token-')) {
                    addResult(`üéØ <strong>TOKEN CUSTOMIZADO DETECTADO!</strong>`, 'success');
                } else {
                    addResult(`‚ÑπÔ∏è Token normal`, 'result');
                }
            } else if (tokenHash) {
                addResult(`üéØ <strong>TOKEN HASH DETECTADO!</strong>`, 'success');
                addResult(`‚Ä¢ Token Hash: <code>${tokenHash}</code>`, 'success');
            } else {
                addResult(`‚ÑπÔ∏è Nenhum token detectado`, 'result');
            }
        }

        // Analisar automaticamente quando a p√°gina carrega
        window.addEventListener('load', analisarURL);
        
        // Analisar quando a URL muda
        window.addEventListener('popstate', analisarURL);
        
        // Analisar quando par√¢metros mudam
        if (window.location.search) {
            //DISABLED setTimeout(analisarURL, 100);
        }
    </script>
</body>
</html>
